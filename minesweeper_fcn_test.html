<!DOCTYPE html>
<html lang="en">

<head>
    <title>Minesweeper</title>
    <link rel='stylesheet' type='text/css' href='css_folder/minesweeper.css'>
</head>

<body>
    <!-- Header -->
    <div id='header'>
        <img src='Images/gear_setting.png' id='gear_pic'> 

        <h1 id='clock'>0:00</h1>
    </div>

    <!-- Board -->
    <div id='board'>
        <!-- Buttons go here -->
    </div>

    <script>
        let minute = 0;
        let tenth_place_second = 0; //represent seconds in tenth place
        let second = 0; //represent second in ones place
        let divlist = []
        let minelist = [];
        function clock() {

            second ++;
            if (second == 10){
                // reset_second + add one to tenth_place_second
                tenth_place_second += 1
                second = 0
            }

            if (tenth_place_second == 6){
                // reset tenth_place_second + add one to minute
                tenth_place_second = 0
                minute += 1
            }
            document.getElementById('clock').innerHTML = minute + ':' + tenth_place_second + '' + second;
        }

        setInterval(clock, 1000);


        function board(n) {

            for (let i = 1; i <= n; i++) {
                for (let j = 1; j <= n; j++) {

                    let button = document.createElement("Button");
                    let board = document.getElementById("board")
                    board.appendChild(button);
                    let string = String(i) + String(j);
                    button.id = 'cell' + string;
                    button.onclick = unearth(button);

                }
                document.getElementById('board').innerHTML += '<br>'
            }
        }

        function setting() {
            // create a pop up window
            pop_up_href = 'setting.html'
            pop_up_name = 'setting_window'
            center_of_window = window.innerWidth / 2

            window.open(pop_up_href, pop_up_name, 
                        'width=400px, height=400px, left=' +
                        center_of_window)
        }

        // click on setting button
        let setting_var = function() {setting()}
        gear_pic.onclick = setting_var

        //auto load a medium board
        board(8)
        
        function minePlacer(gridheight, gridwidth){
        let cell, cellw,cellh, sel, dv;
        let mine = 3;
        let x=0;    //x tracks how many mines are set on the board.
        while(x < mine){          
            cellw = Math.floor(Math.random()*gridwidth)+1; //uses the Random module to select a random row        
            cellh = Math.floor(Math.random()*gridheight)+1;// used the Random module to select a random column      
            cell = document.getElementById('button'+String(cellw)+String(cellh));//and gets the element. 
            dv = cell = document.getElementById('button'+String(cellw)+String(cellh));//and gets the element. 
            
            console.log()       
            if(cell in minelist){ //checks if the element already has a mine placed in it       
                continue;    //if so, the loop continues without incrementing x     
            } 
            else{
                minelist.concat(cell) //Otherwise, it adds the classname "mine" to the cell, indicating that it contains a mine.
                divlist.concat(dv);
                cell.className += "bomb";
                dv.classname += "bomb";
                cell.innerHTML = '<img src = "Images/flag.png">';
                x++;//Then x increments before the while loop restarts.
            }
        }
        return;
    }
    function cellcheck(cell){
        let count=0
        let cID = cell.id;
        console.log(cID)
        let r = parseInt(cID[4]);
        let c = parseInt(cID[5]);
        for(let i = -3;i<=3;++i){
            if(1<= +i <= 8){
                for(let j=-3;j<=3;++j){
                    if(i==0 && j == 0 ){
                        continue;
                    }
                    if(1<=c+j<=8){
                        check= document.getElementById("cell"+String(r+i)+String(c+j));
                        if(check in minelist && count <= Math.max(abs(i),ans(j))){
                            count = Math.max(abs(i),ans(j));
                        }
                    }
                }
            }
        }
        if(count > 0){
            cell.innerHTML = count;   
        }
        else{
            cell.innerHTML = '<img src="Images/gray.png">';
        }
        return;
    }
    function unearth(cell){
        if(cell in minelist){
            console.log(" gameOver");
            return;
        }
        else{
            cellcheck(cell);
            return;
        }
    }
    minePlacer(8,8)

    </script>
</body>

</html>
